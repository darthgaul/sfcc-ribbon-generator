function generateRibbon() {
    if (!uploadedImage) return;
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Extract colors from the uploaded logo
    const colorThief = new ColorThief();
    const palette = colorThief.getPalette(uploadedImage, 5); // Extract 5 colors
    const colors = palette.map(color => `rgb(${color[0]}, ${color[1]}, ${color[2]})`);

    const totalStripes = 10; // 5 bars per side
    const halfStripes = totalStripes / 2;
    const ribbonWidth = canvas.width;
    const halfWidth = ribbonWidth / 2;

    // Generate random widths for the left side
    const leftWidths = generateRandomWidths(halfStripes, halfWidth);
    const rightWidths = leftWidths.slice().reverse(); // Mirror widths for the right side
    const fullWidths = [...leftWidths, ...rightWidths]; // Combine widths

    // Assign colors: mirror the left side colors on the right
    const leftColors = colors.slice(0, halfStripes); // Colors for the left 5 bars
    const rightColors = leftColors.slice().reverse(); // Reverse for the right 5 bars
    const fullColors = [...leftColors, ...rightColors]; // Combine for full ribbon

    // Draw the ribbon
    let currentX = 0;
    for (let i = 0; i < fullWidths.length; i++) {
        ctx.fillStyle = fullColors[i];
        ctx.fillRect(currentX, 0, fullWidths[i], canvas.height);
        currentX += fullWidths[i];
    }

    // Add horizontal lines (unchanged from original design)
    const lineSpacing = canvas.height / 16;
    ctx.strokeStyle = 'rgba(255, 255, 255, 0.25)';
    ctx.lineWidth = 1;
    for (let i = 1; i < 16; i++) {
        ctx.beginPath();
        ctx.moveTo(0, i * lineSpacing);
        ctx.lineTo(ribbonWidth, i * lineSpacing);
        ctx.stroke();
    }

    downloadInstructions.style.display = 'block';
    previousRibbons.push(canvas.toDataURL());
    goBackBtn.disabled = previousRibbons.length <= 1;
    downloadBtn.disabled = false;
}
