<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SFCC Sponsorship Ribbon Generator</title>
    <!-- Optional: Add styles or external libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.min.js"></script>
    <style>
        body {
            background-color: #1a2b4c; /* Dark blue background */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .container {
            background-color: #2e3b5e;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            color: white;
        }
        canvas {
            margin-top: 20px;
            border: 1px solid #fff;
        }
        button {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #downloadInstructions {
            display: none;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SFCC Sponsorship Ribbon Generator</h1>
        <p>Upload your logo to create a unique Space Force Cadet Corps sponsorship ribbon!</p>
        <input type="file" id="logoUpload" accept="image/*">
        <br>
        <button id="generateBtn">Generate Ribbon</button>
        <button id="regenerateBtn" disabled>Regenerate</button>
        <button id="goBackBtn" disabled>Go Back</button>
        <button id="downloadBtn" disabled>Download Ribbon</button>
        <br>
        <canvas id="canvas" width="300" height="100"></canvas>
        <div id="downloadInstructions">Click "Download Ribbon" to save your design!</div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const logoUpload = document.getElementById('logoUpload');
        const generateBtn = document.getElementById('generateBtn');
        const regenerateBtn = document.getElementById('regenerateBtn');
        const goBackBtn = document.getElementById('goBackBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const downloadInstructions = document.getElementById('downloadInstructions');
        let uploadedImage = null;
        let previousRibbons = [];

        logoUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                uploadedImage = new Image();
                uploadedImage.onload = () => {
                    generateBtn.disabled = false;
                };
                uploadedImage.src = URL.createObjectURL(file);
            }
        });

        function generateRandomWidths(numBars, totalWidth) {
            const widths = [];
            let remainingWidth = totalWidth;
            for (let i = 0; i < numBars - 1; i++) {
                const width = Math.random() * (remainingWidth / 2);
                widths.push(width);
                remainingWidth -= width;
            }
            widths.push(remainingWidth);
            return widths;
        }

        function generateRibbon() {
            if (!uploadedImage) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Extract colors from the uploaded logo
            const colorThief = new ColorThief();
            const palette = colorThief.getPalette(uploadedImage, 5); // Extract 5 colors
            const colors = palette.map(color => `rgb(${color[0]}, ${color[1]}, ${color[2]})`);

            const totalStripes = 10; // 5 bars per side
            const halfStripes = totalStripes / 2;
            const ribbonWidth = canvas.width;
            const halfWidth = ribbonWidth / 2;

            // Generate random widths for the left side
            const leftWidths = generateRandomWidths(halfStripes, halfWidth);
            const rightWidths = leftWidths.slice().reverse(); // Mirror widths for the right side
            const fullWidths = [...leftWidths, ...rightWidths]; // Combine widths

            // Assign colors: mirror the left side colors on the right
            const leftColors = colors.slice(0, halfStripes); // Colors for the left 5 bars
            const rightColors = leftColors.slice().reverse(); // Reverse for the right 5 bars
            const fullColors = [...leftColors, ...rightColors]; // Combine for full ribbon

            // Draw the ribbon
            let currentX = 0;
            for (let i = 0; i < fullWidths.length; i++) {
                ctx.fillStyle = fullColors[i];
                ctx.fillRect(currentX, 0, fullWidths[i], canvas.height);
                currentX += fullWidths[i];
            }

            // Add horizontal lines
            const lineSpacing = canvas.height / 16;
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.25)';
            ctx.lineWidth = 1;
            for (let i = 1; i < 16; i++) {
                ctx.beginPath();
                ctx.moveTo(0, i * lineSpacing);
                ctx.lineTo(ribbonWidth, i * lineSpacing);
                ctx.stroke();
            }

            downloadInstructions.style.display = 'block';
            previousRibbons.push(canvas.toDataURL());
            goBackBtn.disabled = previousRibbons.length <= 1;
            downloadBtn.disabled = false;
            regenerateBtn.disabled = false;
        }

        generateBtn.addEventListener('click', generateRibbon);

        regenerateBtn.addEventListener('click', generateRibbon);

        goBackBtn.addEventListener('click', () => {
            if (previousRibbons.length > 1) {
                previousRibbons.pop();
                const img = new Image();
                img.onload = () => {
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                };
                img.src = previousRibbons[previousRibbons.length - 1];
                goBackBtn.disabled = previousRibbons.length <= 1;
                downloadBtn.disabled = false;
            }
        });

        downloadBtn.addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'sponsorship-ribbon.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
    </script>
</body>
</html>
